#!/bin/bash
apt-get clean && apt-get update && apt-get upgrade -y && apt-get dist-upgrade -y

# Basic installs
apt-get install vim tmux curl lib32gcc1 proxychains htop curl rdesktop tcpdump git python -y

# Setup Tmux
wget -O ~/.tmux.conf https://raw.githubusercontent.com/skapunker/dotfiles/master/.tmux.conf
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# Run PTF
mkdir /pentest
cd /pentest
git clone -b lmg https://github.com/skapunker/ptf
cd ptf
./ptf --update-all >>EOF
yes
EOF

#Distro Specific Installations
if [ -f "/etc/os-release" ]; then
        source /etc/os-release
fi

#Ubuntu 18.04
if [ ID=ubuntu ]; then

        #OpenVAS Installation:
        add-apt-repository ppa:mrazavi/openvas -y
        apt update -y
        apt upgrade -y
        apt install sqlite3 openvas9 -y
        apt install texlive-latex-extra --no-install-recommends -y
        apt install texlive-fonts-recommended --no-install-recommends -y
        apt install libopenvas9-dev
        greenbone-nvt-sync
        greenbone-scapdata-sync
        greenbone-certdata-sync
        systemctl restart openvas-scanner
        systemctl restart openvas-manager
        systemctl restart openvas-gsa
        openvasmd --rebuild --progress --verbose

        #PowerShell Install For 18.04:
        wget -q https://packages.microsoft.com/config/ubuntu/18.04/packages-microsoft-prod.deb
        dpkg -i packages-microsoft-prod.deb
        apt-get update
        apt-get install -y powershell
#Kali
elif [ ID=kali ]; then

        #OpenVAS Installation:
        apt install openvas
        openvas-setup
        openvasmd –user=admin –new-password=admin #Setting the same (insecure) password as the Ubuntu install

        #Dependencies For PowerShell
        wget http://ftp.us.debian.org/debian/pool/main/i/icu/libicu57_57.1-9_amd64.deb
        dpkg -i libicu57_57.1-9_amd64.deb
        apt-get update && apt-get install -y curl gnupg apt-transport-https
        curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -
        echo "deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-debian-stretch main" | tee /etc/apt/sources.list.d/powershell.list
        apt-get update && apt-get install -y powershell

else
        echo "This OS is not supported yet." 1>&2
fi

apt-get clean && apt-get update && apt-get upgrade -y && apt-get dist-upgrade -y
